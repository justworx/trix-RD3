#
# DATABASE CONFIG
#  - SQLITE-3
#  - ~/dev/irclog.sqlite3
#
{
	"module" : "sqlite3",
	"args" : [],
	"path" : "~/dev/irclog.sqlite3",
	"auto" : True,
	"sql"  : {
		"create" : [
			
			# BOT
			"""
			create table if not exists bot (
				botid   INTEGER PRIMARY KEY AUTOINCREMENT, 
				botname TEXT NOT NULL
			)
			""",
			"create unique index if not exists ix_bot on bot (botname)",
			
			# NETWORK
			"""
			create table if not exists network (
				netid   INTEGER PRIMARY KEY AUTOINCREMENT, 
				network TEXT NOT NULL
			)
			""", """
			create unique index if not exists ix_network on network (
				network
			)""",
			
			# NICKNAME
			"""
			create table if not exists nickname (
				nickid   INTEGER PRIMARY KEY AUTOINCREMENT, 
				nickname TEXT NOT NULL
			)
			""", """
			create unique index if not exists ix_nickname on nickname (
				nickid, nickname
			)
			""",
			
			# USERNAME
			"""
			create table if not exists username (
				userid   INTEGER PRIMARY KEY AUTOINCREMENT, 
				username TEXT NOT NULL
			)
			""", """
			create unique index if not exists ix_username on username (
				userid, username
			)
			""",
			
			# HOSTMASK
			"""
			create table if not exists hostmask (
				maskid   INTEGER PRIMARY KEY AUTOINCREMENT,
				hostmask TEXT NOT NULL
			)
			""", """
			create unique index if not exists ix_hostmask on hostmask (
				hostmask
			)
			""",
			
			# REALNAME
			"""
			create table if not exists realname (
				nameid   INTEGER PRIMARY KEY AUTOINCREMENT, 
				realname TEXT
			)
			""", """
			create unique index if not exists ix_realname on realname (
				nameid, realname
			)
			""",
			
			# IDENTITY
			"""
			create table if not exists identity (
				id     INTEGER PRIMARY KEY AUTOINCREMENT, 
				netid  INTEGER NOT NULL, 
				nickid INTEGER NOT NULL, 
				userid INTEGER NOT NULL, 
				maskid INTEGER NOT NULL, 
				nameid INTEGER NOT NULL,
				idtime INTEGER NOT NULL
			)
			""", """
			create unique index if not exists ix_idnick on identity (
				netid, nickid
			)
			""", """
			create unique index if not exists ix_iduser on identity (
				netid, userid
			)
			""", """
			create unique index if not exists ix_idmask on identity (
				netid, maskid
			)
			""",
			
			# CHAT LOG
			"""
			create table if not exists chatlog (
				id      INTEGER PRIMARY KEY NOT NULL, 
				netid   INTEGER NOT NULL, 
				chanid  INTEGER NOT NULL,
				text    TEXT, 
				logtime INTEGER NOT NULL
			)
			""", """
			create unique index if not exists ix_chatlog on chatlog (
				netid, chanid, logtime
			)
			""", """
			create unique index if not exists ix_chatlogid on chatlog (
				id, logtime
			)
			"""
			
		],
		
		
		"op" : {
			
			"addbot" : "insert into bot (botname) values (?)",
			"addnet" : "insert into network values (?,?)",
			"addchan" : "insert into channel values (?,?,?)",
			"addnick" : "insert into nickname values (?,?,?)",
			"adduser" : "insert into username values (?,?,?)",
			"addmask" : "insert into hostmask values (?,?,?)",
			"addname" : "insert into realname values (?,?,?)",
			"addid"   : "insert into identity values (?,?,?,?,?,?)",
			"addchat" : "insert into chatlog values (?,?,?,?,?)",
			
			"netid" : "select netid from network where network = ?",
			"chanid" : "select chanid from channel where channel = ?",
			"nickid" : "select nickid from nickname where nickname = ?",
			"userid" : "select userid from username where username = ?",
			"maskid" : "select maskid from hostmask where hostmask = ?"
			
		}
	}
}
